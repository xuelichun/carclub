var ca_id=0;
var flag=2;
$(function(){
	var strHref=this.location.href;
	ca_id=strHref.getQuery("ca_id");
	selectClubAlbum();
});
function selectClubAlbum(){
	var club_id=1;
	var content="上传到：<select id='p' style='width: 150px' size='1' onchange='changeClubAlbum()'>";
	$.getJSON("../clubAlbumk.do",{"club_id":club_id},function(data){
		for(var i=0;i<data.length;i++){
			content+="<option value="+data[i].ca_id+">"+data[i].ca_name+"</option>";
			if(i==0){$("input[name=ca_id]").val(data[i].ca_id);}
		}
		content+="</select>";
		$("#clubAlbumOption").html(content);
		dacideClubAlbum();
	});
}

function addFileButton(){
	var content="<div style='float: left'><div id='preview"+flag+"' class='preview'></div>"+  
						"<input type='file' id='preview"+flag+"' name='pa_img' onchange='preview(this)' /> </div> ";
	flag++;
	/*var content=$("#clubPictures").html();
	content+="<input type='file' name='pa_img'/>";
	$("#clubPictures").html(content);*/
	$("#dysn").append(content);
}

$(document).ready(function() { 
    // bind 'myForm' and provide a simple callback function 
    $('#myForm').ajaxForm(function(data) { 
    	alert("成功:"+data[0]+";失败:"+data[1]);
    	//location.href="uploadClubAlbum.html";
    });    
}); 

function changeClubAlbum(){
	var ca_id=$("#p option:selected").val();
	$("input[name=ca_id]").val(ca_id);
}

function dacideClubAlbum(){
	if(ca_id!=0||ca_id!=null){
		$("#p").val(ca_id);
	}
}

function preview(file){  
	var prevDiv = document.getElementById(file.id);  
	if(file.files && file.files[0]){  
		var reader = new FileReader();  
		reader.onload = function(evt){  
			prevDiv.innerHTML = '<img src="' + evt.target.result + '" width="200px" height="200px" />';  
		}    
		reader.readAsDataURL(file.files[0]); 
		addFileButton();
	}else{  
		prevDiv.innerHTML = '<div class="img" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\'' + file.value + '\'"></div>';  
	}  
}